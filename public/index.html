<!DOCTYPE HTML>
<html>

<head>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>

<body>
  <div id="app">
    <div v-if="loading">Loading...</div>
    <div v-else>
      <div v-for="(set, i) in questions">
        <p>{{set.about}}</p>
        <table>
          <tr>
            <td>質問</td>
            <td>そうだ</td>
            <td>まあそうだ</td>
            <td>やや違う</td>
            <td>違う</td>
          </tr>
          <tr v-for="(q, j) in set.body">
            <td>{{q.question}}</td>
            <td v-for="k in [1, 2, 3, 4]">
              <input type="radio" :value="q.reversePoint ? 5-k : k" :id="i+'-'+j+'-'+k" v-model="points[i][j]">
              <label :for="i+'-'+j+'-'+k">{{k}}</label>
            </td>
          </tr>
        </table>
      </div>
      <div>
        <p>あなたの点数は: {{sumOfPoints()}}点です。</p>
      </div>
    </div>
  </div>
  <script>



    let app = new Vue({
      el: '#app',
      data: {
        questions: null,
        points: [],
        loading: true,
        errored: false
      },
      methods: {
        sumOfPoints: function () {
          console.log("compute sum");
          if (this.loading) {
            return 0;
          } else {
            return this.points.flat().reduce((currentSum, current) => {
              return currentSum + current;
            })
          }
        }
      },
      mounted: function () {
        fetch('/questions.json')
          .then((res) => {
            return res.json();
          })
          .then((questions) => {
            this.questions = questions;
            console.log(this.questions);
            for (let i = 0; i < this.questions.length; i++) {
              this.points.push(new Array(this.questions[i].body.length).fill(0));
            }
          })
          .finally(() => {
            this.loading = false;
          });
      }
    })
  </script>

</body>

</html>